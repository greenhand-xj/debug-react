<html>

<body>
  <script src="../../../build/oss-stable/react/umd/react.development.js"></script>
  <script src="../../../build/oss-stable/react-dom/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.js"></script>
  <div id="container"></div>
  <script type="text/babel">
    // 使用 createRoot的方式
    const root = ReactDOM.createRoot(document.getElementById('container'));
    const { useState, useEffect, useRef, useReducer, useContext, createContext, useCallback, useMemo } = React;
    //#region
    // function App() {
    //   const [count, setCount] = useState(0);
    //   console.log('count',count)
    //   useEffect(() => {
    //     const intervalId = setTimeout(function triggerFunction(){
    //       debugger
    //       setCount(prevCount => prevCount + 1);
    //     }, 2000);

    //     return () => clearInterval(intervalId); // 清理定时器
    //   }, []);

    //   return (
    //     <button onClick={() => setCount(count + 1)}>Click me {count}</button>
    //   );
    // }
    //#endregion

    //#region
    // function usePrevValue(value) {
    //   const prev = useRef(null);
    //   useEffect(() => {
    //     prev.current = value;
    //   }, [value]);
    //   return [prev.current];
    // }

    // function App(props) {
    //   const [count, setCount] = useState(0);
    //   console.log(count)
    //   const [prev] = usePrevValue(count);
    //   console.log(prev)
    //   return (
    //     <div className='App'>
    //       <button onClick={() => setCount(count + 1)}>{count}</button>
    //       <button>{prev}</button>
    //     </div>
    //   );
    // }
    //#endregion

    //#region
    // function App() {
    //   const [count, setCount] = useState(1);
    //   console.log(1);

    //   useEffect(() => {
    //     console.log(2);
    //     return () => {
    //       console.log(3);
    //     };
    //   }, [count]);

    //   useEffect(() => {
    //     console.log(4);
    //     setCount((count) => count + 1);
    //   }, []);

    //   return <Child count={count} />;
    // }
    // function Child({ count }) {
    //   useEffect(() => {
    //     console.log(5);
    //     return () => {
    //       console.log(6);
    //     };
    //   }, [count]);

    //   return <span>hello world</span>;
    // }
    //#endregion

    //#region
    // function App() {
    //   const [count, setCount] = useState(1);

    //   const handleClick = () => {
    //     setCount((count) => count + 1);
    //     setCount((count) => count + 1);
    //   };

    //   return (
    //     <div>
    //       <button onClick={handleClick}>click me {count}</button>
    //     </div>
    //   )
    // }
    //#endregion
    //#region
    // let initialState = (() => {
    //   //死循环2000ms
    //   let start = Date.now()
    //   while (Date.now() - start < 2000) { }
    //   return {
    //     count: 0
    //   }
    // })()

    // function counterReducer(state, action) {
    //   switch (action.type) {
    //     case 'increment':
    //       return state.count + action.payload
    //     case 'decrement':
    //       return { count: state.count - action.payload }
    //     default:
    //       throw new Error()
    //   }
    // }

    // function App() {
    //   const [state, dispatch] = useReducer(counterReducer, { count: 0 }, (initialState) => {
    //     //死循环2000ms iife
    //     // let start = Date.now()
    //     // while (Date.now() - start < 2000) { }
    //     return {
    //       count: initialState.count + 2
    //     }
    //   });
    //   const handleClick = () => {
    //     debugger
    //     dispatch({ type: 'increment', payload: 1 });
    //     dispatch({ type: 'decrement', payload: 2 });
    //   }
    //   return (
    //     <button onClick={handleClick}>{state.count}</button>
    //   )
    // }
    //#endregion

    // #region
    // function App() {
    //   const [search, setSearch] = useState('');
    //   const handleChange = (e) => setSearch(e.target.value);
    //   return (
    //     <input type="text" value={search} onChange={handleChange} />
    //   )
    // }
    // #endregion

    // #region
    // const ThemeContext = createContext(null);
    // function Form({ children }) {
    //   return (
    //     <Panel title="Welcome">
    //       <Button>Sign up</Button>
    //       <Button>Log in</Button>
    //     </Panel>
    //   );
    // }

    // function Panel({ title, children }) {
    //   const theme = useContext(ThemeContext);
    //   return (
    //     <section>
    //       <h1>{title}--{theme}</h1>
    //       {children}
    //     </section>
    //   )
    // }

    // function Button({ children }) {
    //   const theme = useContext(ThemeContext);
    //   return (
    //     <button>
    //       {children}--{theme}
    //     </button>
    //   );
    // }

    // function App() {
    //   const [theme, setTheme] = useState('light');
    //   return (
    //     <ThemeContext.Provider value={theme}>
    //       <Form />
    //       <input
    //         type="checkbox"
    //         checked={theme === 'dark'}
    //         onChange={(e) => {
    //           setTheme(e.target.checked ? 'dark' : 'light')
    //         }}
    //       />
    //     </ThemeContext.Provider>
    //   );
    // }
    // #endregion
    // #region
    // function Child(props) {
    //   console.log('Child组件运行了')
    //   return (
    //     <div className='Child'>
    //       <div ref={ref}>Child子组件</div>
    //       <div>name: {props.name}</div>
    //     </div>
    //   )
    // }
    // const NewChild = React.memo(Child)


    // function MyFun(props) {
    //   console.log('MyFun组件运行了')
    //   const [count, setCount] = useState(1)
    //   function handleClick() {
    //     setCount(count + 1)
    //   }
    //   return (
    //     <div className='MyFun'>
    //       <div>state: {count}</div>
    //       <NewChild name='NewChild' setCount={setCount}></NewChild>
    //       <button onClick={handleClick}>更新</button>
    //     </div>
    //   )
    // }

    // function App() {
    //   console.log('App组件运行了')
    //   return (
    //     <div className="App">
    //       <div>react源码调试</div>
    //       <MyFun name='MyFun'></MyFun>
    //     </div>
    //   );
    // }
    // #endregion

    //#region
    // function App() {
    //   const [count, setCount] = useState(0);
    //   const callbackFn = useCallback(() => {
    //     console.log('useCallbackFn执行了')
    //   }, [])
    //   const double = useMemo(() => {
    //     console.log("useMemoFn执行了")
    //     return count * 2
    //   }, [count])
    //   return (
    //     <button onClick={() => setCount(count + 1)}>Click me {count} {double}</button>
    //   )
    // }
    //#endregion

    function App() {
      const [count, setCount] = useState(-1);
      const callbackFn = useCallback(() => {
        console.log(count)
      }, [count])
      return (
        <button onClick={() => {
          setCount(count + 1)
          callbackFn()
        }}>Click me {count}</button>
      )
    }
    root.render(<App />);
    // root.render(<h1>hello world</h1>);
  </script>
</body>

</html>